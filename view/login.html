<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>TrendScope - 로그인</title>
  <style>
    body { margin: 0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans KR", Arial, "Apple SD Gothic Neo", "Malgun Gothic", sans-serif; }

    :root{
      --brand:#0462D2;
      --text:#0f172a;
      --muted:#64748b;
      --cardShadow: 0 18px 60px rgba(15,23,42,.10);
    }

    /* 간단 헤더 */
    .topbar{
      position:sticky; top:0; z-index:50;
      background: rgba(255,255,255,.86);
      backdrop-filter: blur(10px);
      border-bottom:1px solid rgba(15,23,42,.06);
    }
    .topbar .in{
      width:min(1080px,100%);
      margin:0 auto;
      padding:0 20px;
      height:64px;
      display:flex; align-items:center; justify-content:space-between;
    }
    .brand{
      display:flex; align-items:center; gap:10px; font-weight:900;
      letter-spacing:-.02em; text-decoration:none; color:var(--brand);
    }
    .brand .mark{
      width:22px;height:22px;border-radius:6px;
      background: linear-gradient(135deg, rgba(4,98,210,.16), rgba(4,98,210,.04));
      border:1px solid rgba(4,98,210,.22);
    }
    .topbar a{ text-decoration:none; color:#334155; font-weight:800; font-size:13px; }

    /* scope(충돌 방지) */
    #tsLoginWrap{
      min-height: calc(100vh - 64px);
      display:flex; align-items:center; justify-content:center;
      padding:40px 16px;
      background:
        radial-gradient(900px 520px at 18% 42%, rgba(4,98,210,.12) 0%, rgba(4,98,210,0) 62%),
        radial-gradient(760px 460px at 36% 68%, rgba(59,130,246,.08) 0%, rgba(59,130,246,0) 58%),
        linear-gradient(180deg, #ffffff 0%, #ffffff 100%);
    }
    #tsShell{width:min(1080px,100%);display:flex;gap:32px;align-items:center;}

    #tsLeft{flex:1.2;color:var(--text);padding:12px 8px;}
    #tsLeft .logo{font-size:44px;font-weight:800;letter-spacing:-0.02em;color:var(--brand);}
    #tsLeft .desc{margin:10px 0 0;color:#475569;line-height:1.6;font-size:15px;}
    #tsLeft .status{
      display:inline-flex;align-items:center;gap:10px;margin-top:18px;
      padding:10px 12px;border-radius:999px;
      background: rgba(4,98,210,.06);
      border: 1px solid rgba(4,98,210,.16);
      font-size:13px;color:#1f2937;
    }
    #tsLeft .dot{
      width:8px;height:8px;border-radius:50%;
      background:#22c55e;
      box-shadow:0 0 0 4px rgba(34,197,94,.14);
      display:inline-block;
    }

    #tsRight{flex:.9;width:100%;max-width:420px;}
    #tsCard{
      background:#fff;border-radius:18px;padding:26px 26px 22px;
      box-shadow: var(--cardShadow);
      border: 1px solid rgba(15,23,42,.06);
    }
    #tsTitle{margin-bottom:18px;}
    #tsTitle .h{font-size:24px;font-weight:800;color:#111827;letter-spacing:-0.02em;}
    #tsTitle .s{margin-top:6px;font-size:13px;color:#6b7280;}

    /* input group */
    .tsGroup{
      border:1px solid #e5e7eb;border-radius:12px;overflow:hidden;background:#fff;
      transition: border-color .15s, box-shadow .15s;
    }
    .tsGroup.isFocus{
      border-color:var(--brand);
      box-shadow:0 0 0 4px rgba(4,98,210,.12);
    }
    .tsRow{padding:10px 12px;}
    .tsLabel{font-size:12px;color:#9ca3af;margin-bottom:6px;}
    .tsInput{
      width:100%;height:30px;border:0;outline:0;
      font-size:14px;color:#111827;background:transparent;
    }
    .tsDivider{height:1px;background:#eef2f7;}

    .tsOpt{display:flex;align-items:center;justify-content:space-between;gap:10px;margin:12px 2px 14px;}
    .tsRemember{display:flex;align-items:center;gap:8px;color:#6b7280;font-size:13px;}
    .tsRemember input{width:16px;height:16px;accent-color:var(--brand);}
    .tsLink{color:#6b7280;font-size:13px;text-decoration:none;}
    .tsLinkBlue{color:var(--brand);text-decoration:none;font-weight:800;}

    #tsLoginBtn{
      width:100%;height:46px;border-radius:10px;border:0;
      background:#d1d5db;color:#fff;font-weight:800;
      cursor:not-allowed;transition:background .15s;
    }

    .tsMsg{
      margin-top:12px;
      font-size:12px; line-height:1.4;
      padding:10px 12px; border-radius:12px;
      display:none;
    }
    .tsMsg.ok{ display:block; color:#166534; background:rgba(34,197,94,.10); border:1px solid rgba(34,197,94,.18); }
    .tsMsg.err{ display:block; color:#b91c1c; background:rgba(239,68,68,.08); border:1px solid rgba(239,68,68,.18); }

    .tsHr{
      display:flex;align-items:center;gap:12px;margin:18px 0;
      color:#9ca3af;font-size:12px;
    }
    .tsHr span{flex:1;height:1px;background:#e5e7eb;}

    #tsSignup{
      display:flex;align-items:center;justify-content:center;
      height:46px;border-radius:10px;background:var(--brand);color:#fff;
      font-size:15px;font-weight:800;text-decoration:none;
    }

    #tsFoot{
      display:flex;justify-content:center;gap:14px;margin-top:14px;
      font-size:12px;color:#64748b;
    }
    #tsFoot .sep{color:#cbd5e1}

    @media (max-width:980px){
      #tsShell{gap:0;}
      #tsLeft{display:none;}
    }
  </style>
</head>

<body>
  <div class="topbar">
    <div class="in">
      <a class="brand" href="index.html" aria-label="home">
        <span class="mark" aria-hidden="true"></span>
        <span>TrendScope</span>
      </a>
      <a href="index.html">홈으로</a>
    </div>
  </div>

  <div id="tsLoginWrap">
    <div id="tsShell">

      <!-- LEFT -->
      <div id="tsLeft">
        <div class="logo">TrendScope</div>
        <p class="desc">
          통합 ID로 TrendScope의 모든 서비스를 이용할 수 있습니다.<br>
          지금은 프로토타입(로컬 저장) 방식으로 로그인합니다.
        </p>
        <div class="status">
          <span class="dot"></span>
          프로토타입 모드(서버 미연결)
        </div>
      </div>

      <!-- RIGHT -->
      <div id="tsRight">
        <div id="tsCard">

          <div id="tsTitle">
            <div class="h">로그인</div>
            <div class="s">아이디와 비밀번호를 입력해 주세요.</div>
          </div>

          <form id="loginForm" method="post" action="#">
            <div class="tsGroup" id="tsGroup">
              <div class="tsRow">
                <div class="tsLabel">아이디</div>
                <input id="tsId" class="tsInput" name="member_id" type="text"
                       placeholder="아이디를 입력해 주세요."
                       autocomplete="username">
              </div>

              <div class="tsDivider"></div>

              <div class="tsRow">
                <div class="tsLabel">비밀번호</div>
                <input id="tsPw" class="tsInput" name="passwd" type="password"
                       placeholder="비밀번호를 입력해 주세요."
                       autocomplete="current-password">
              </div>
            </div>

            <div class="tsOpt">
              <label class="tsRemember">
                <input id="tsRemember" type="checkbox">
                아이디 저장
              </label>
              <a class="tsLink" href="#" onclick="alert('프로토타입: 비밀번호 찾기 미구현'); return false;">비밀번호 찾기</a>
            </div>

            <button id="tsLoginBtn" type="submit" disabled>로그인</button>

            <div class="tsMsg" id="msgBox"></div>

            <div class="tsHr">
              <span></span>
              아직 계정이 없으신가요?
              <span></span>
            </div>

            <a id="tsSignup" href="signup.html">회원가입</a>
          </form>
        </div>

        <div id="tsFoot">
          <a class="tsLinkBlue" href="#" onclick="alert('프로토타입: 아이디 찾기 미구현'); return false;">아이디 찾기</a>
          <span class="sep">|</span>
          <a class="tsLinkBlue" href="#" onclick="alert('프로토타입: 비밀번호 찾기 미구현'); return false;">비밀번호 찾기</a>
        </div>

      </div>
    </div>
  </div>

  <script>
    // =========================
    // ✅ 서버 없이 로컬 저장으로 로그인 흉내
    // (signup.html에서 저장한 계정만 로그인 가능)
    // =========================
    const TS_USERS_KEY   = "ts_users";
    const TS_SESSION_KEY = "ts_session";
    const TS_SAVED_ID_KEY = "ts_saved_id";

    function loadUsers(){
      try { return JSON.parse(localStorage.getItem(TS_USERS_KEY) || "[]"); }
      catch { return []; }
    }

    function saveSession(session){
      localStorage.setItem(TS_SESSION_KEY, JSON.stringify(session));
    }

    function setMsg(type, text){
      const box = document.getElementById("msgBox");
      box.className = "tsMsg " + (type === "ok" ? "ok" : "err");
      box.textContent = text;
      box.style.display = "block";
    }

    function hideMsg(){
      const box = document.getElementById("msgBox");
      box.style.display = "none";
      box.textContent = "";
    }

    async function sha256(str){
      if (window.crypto && crypto.subtle) {
        const buf = new TextEncoder().encode(str);
        const hash = await crypto.subtle.digest("SHA-256", buf);
        return Array.from(new Uint8Array(hash)).map(b => b.toString(16).padStart(2,"0")).join("");
      }
      return "plain:" + str; // fallback(프로토타입)
    }

    async function apiLogin(username, password){
      const users = loadUsers();
      const user = users.find(u => u.memberId === username);
      if (!user) return { ok:false, message:"등록되지 않은 아이디입니다. 회원가입 후 로그인해 주세요." };

      const pwHash = await sha256(password);
      if (user.passwordHash !== pwHash) return { ok:false, message:"비밀번호가 올바르지 않습니다." };

      return { ok:true, user };
    }

    (function(){
      const idEl = document.getElementById('tsId');
      const pwEl = document.getElementById('tsPw');
      const btn  = document.getElementById('tsLoginBtn');
      const group= document.getElementById('tsGroup');
      const remember = document.getElementById('tsRemember');

      // ✅ 가입 후 넘어올 때: login.html?registered=1&id=...
      const params = new URLSearchParams(location.search);
      const preId = params.get("id");
      const registered = params.get("registered");

      // ✅ 아이디 저장 로드
      const savedId = localStorage.getItem(TS_SAVED_ID_KEY);
      if (preId) {
        idEl.value = preId;
      } else if (savedId) {
        idEl.value = savedId;
        remember.checked = true;
      }

      if (registered === "1") {
        setMsg("ok", "회원가입이 완료되었습니다. 로그인해 주세요.");
      }

      function toggleBtn(){
        const ok = (idEl.value || '').trim().length > 0 && (pwEl.value || '').trim().length > 0;
        btn.disabled = !ok;
        btn.style.cursor = ok ? 'pointer' : 'not-allowed';
        btn.style.background = ok ? '#0462D2' : '#d1d5db';
      }

      function focusOn(){ group.classList.add('isFocus'); }
      function focusOff(){
        const ae = document.activeElement;
        if(ae !== idEl && ae !== pwEl) group.classList.remove('isFocus');
      }

      idEl.addEventListener('input', () => { hideMsg(); toggleBtn(); });
      pwEl.addEventListener('input', () => { hideMsg(); toggleBtn(); });
      idEl.addEventListener('focus', focusOn);
      pwEl.addEventListener('focus', focusOn);
      idEl.addEventListener('blur', focusOff);
      pwEl.addEventListener('blur', focusOff);

      document.getElementById('loginForm').addEventListener('submit', async function(e){
        e.preventDefault();
        hideMsg();

        const username = (idEl.value || "").trim();
        const password = (pwEl.value || "");

        btn.disabled = true;
        btn.textContent = "로그인 중...";

        try{
          const r = await apiLogin(username, password);
          if (!r.ok) {
            setMsg("err", r.message || "로그인에 실패했습니다.");
            return;
          }

          // ✅ 아이디 저장
          if (remember.checked) localStorage.setItem(TS_SAVED_ID_KEY, username);
          else localStorage.removeItem(TS_SAVED_ID_KEY);

          // ✅ 세션 저장
          saveSession({
            memberId: r.user.memberId,
            name: r.user.name || r.user.memberId,
            loggedInAt: new Date().toISOString()
          });

          // ✅ 홈으로 이동
          location.href = "index.html";
        } finally {
          btn.textContent = "로그인";
          toggleBtn();
        }
      });

      toggleBtn();
    })();
  </script>
</body>
</html>
